# .cnb.yml
$:
  vscode:
    - docker:
        # æŒ‡å®šå¼€å‘ç¯å¢ƒé•œåƒï¼Œå¯ä»¥æ˜¯ä»»æ„å¯è®¿é—®çš„é•œåƒã€‚
        # å¦‚æœ image æŒ‡å®šçš„é•œåƒä¸­å·²å®‰è£… code-server ä»£ç æœåŠ¡ï¼Œå°†ä½¿ç”¨å•å®¹å™¨æ¨¡å¼å¯åŠ¨å¼€å‘ç¯å¢ƒ
        # å¦‚æœ image æŒ‡å®šçš„é•œåƒä¸­æœªå®‰è£… code-server ä»£ç æœåŠ¡ï¼Œå°†ä½¿ç”¨åŒå®¹å™¨æ¨¡å¼å¯åŠ¨å¼€å‘ç¯å¢ƒ
        # å¦‚ä¸‹é•œåƒä¸º CNB é»˜è®¤å¼€å‘ç¯å¢ƒé•œåƒï¼Œå·²å®‰è£…ä»£ç æœåŠ¡ï¼Œå°†ä½¿ç”¨å•å®¹å™¨æ¨¡å¼å¯åŠ¨å¼€å‘ç¯å¢ƒ
        # å¯æŒ‰éœ€æ›¿æ¢ä¸ºå…¶ä»–é•œåƒ
        image: cnbcool/default-dev-env:latest
      services:
        - vscode
        - docker
      # å¼€å‘ç¯å¢ƒå¯åŠ¨åä¼šæ‰§è¡Œçš„ä»»åŠ¡
      stages:
        - name: æŸ¥çœ‹å½“å‰è·¯å¾„ä¸‹æ–‡ä»¶
          script:
            - echo "å½“å‰è·¯å¾„ä¸º $(pwd)"
            - ls -al

main: # è§¦å‘åˆ†æ”¯
  push: # è§¦å‘äº‹ä»¶
    - docker:
        image: node:22 # æµæ°´çº¿æ‰§è¡Œç¯å¢ƒï¼Œå¯ä»¥æŒ‡å®šä»»æ„dockeré•œåƒ
      stages:
        - name: ğŸ–¨ï¸ æ‰“å°ç¯å¢ƒ
          if: |
            case "$CNB_COMMIT_MESSAGE" in *"[deploy]"* ) true ;; * ) false ;; esac
          script: |
            node -v && npm -v

        - name: ğŸ“¦ï¸ å®‰è£…ä¾èµ–
          if: |
            case "$CNB_COMMIT_MESSAGE" in *"[deploy]"* ) true ;; * ) false ;; esac
          script: npm config set registry https://registry.npmmirror.com && npm i

        - name: ğŸ› ï¸ æ„å»ºå½“å‰é¡¹ç›®
          if: |
            case "$CNB_COMMIT_MESSAGE" in *"[deploy]"* ) true ;; * ) false ;; esac
          script: npm run docs:build

        - name: ğŸšš éƒ¨ç½²åˆ°Github Pages
          if: |
            case "$CNB_COMMIT_MESSAGE" in *"[deploy]"* ) true ;; * ) false ;; esac
          imports: https://cnb.cool/sumu.m/secret-key/-/blob/main/pages.yaml
          script: |
            # é…ç½®gitç”¨æˆ·ä¿¡æ¯(ä¸é…ç½®çš„è¯æ¨é€ä¸Šå»ä¼šå‡ºç° cnb_name and cnb_name commitè¿™ç§æç¤º)
            git config --global user.name "cnb"
            git config --global user.email "2038035593@qq.com"

            # è¿›å…¥æ„å»ºè¾“å‡ºç›®å½•
            cd ./src/.vitepress/dist
            
            # åˆå§‹åŒ–gitå¹¶æ¨é€åˆ°github pagesåˆ†æ”¯
            git init
            git add .
            git commit -m "deploy to Github Pages from cnb"
            git branch -M master
            git remote add origin "https://${GITHUB_CNB_SYNC}@github.com/docs-site/vitepress-theme-mist-docs.git"
            git push -fu origin master:gh-pages
          